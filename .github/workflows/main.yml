name: Releases
on:
  push:
   branches: [ master ]
  pull_request:
    branches: [ master ]

  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
       
    steps: 
      - uses: actions/checkout@v2.3.4
      
    
      - name: setup-msbuild
        uses: microsoft/setup-msbuild@v1.1
        with:
          msbuild-architecture: x64
          
      - name: Build app for release 
        run: msbuild TestApp.sln -t:rebuild /p:Platform=x64 /p:Configuration=Release /p:LocalizedBuild=true
        
      - name: Download Logs
        run: |
           # Replace 'YOUR_ACCESS_TOKEN' with your actual personal access token
            TOKEN="GH_PAT"

           # Fetch the latest workflow run ID
           $RUN_ID = (Invoke-RestMethod -Uri "https://api.github.com/repos/$env:GITHUB_REPOSITORY/actions/runs?event=push" -Headers @{ Authorization = "Bearer $GITHUB_TOKEN" } | Select-Object -First 1).id

           # Fetch logs for the latest workflow run
            $LOGS = (Invoke-RestMethod -Uri "https://api.github.com/repos/$env:GITHUB_REPOSITORY/actions/runs/$RUN_ID/logs" -Headers @{ Authorization = "Bearer $GITHUB_TOKEN" }).content

            # Save logs to a file
             $LOGS | Out-File -FilePath "logs.txt"
            
            
            
